global
    log stdout format raw local0

defaults
    mode tcp
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend oxidb_front
    bind *:5500
    default_backend oxidb_leader

backend oxidb_leader
    option tcp-check

    # Send length-prefixed JSON: {"cmd":"raft_metrics"}
    # 22 bytes payload -> 0x16000000 in u32 LE, then the JSON
    tcp-check send-binary 160000007b22636d64223a22726166745f6d657472696373227d

    # Only the Raft leader will have "state":"Leader" in its response
    # Binary match for "state":"Leader" (quotes are literal JSON chars)
    tcp-check expect binary 227374617465223a224c656164657222

    default-server inter 1s fall 2 rise 1

    server node1 oxidb-node1:4444 check
    server node2 oxidb-node2:4444 check
    server node3 oxidb-node3:4444 check
    server node4 oxidb-node4:4444 check
